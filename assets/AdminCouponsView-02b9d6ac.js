import{d as R,q as U,r as g,K as I,w as T,a as b,c as h,k as d,l as A,A as q,u as i,j as D,g as e,T as y,z as v,v as P,S,Q as F,h as B,o as O,F as E,y as j,e as z,t as f,N as $,O as M}from"./index-a7dbf281.js";import{f as V,a as H}from"./useDate-df2f2ebb.js";import{u as K}from"./useModal-0d3c2a79.js";import{_ as X}from"./AdminDeleteModal.vue_vue_type_script_setup_true_lang-a61d5ec3.js";import{P as Q}from"./PaginationComponent-ceabea3d.js";const G={class:"modal-content bcoupon-0"},J=e("h5",{id:"exampleModalLabel",class:"modal-title"},[e("span",null,"新增優惠券")],-1),W={class:"modal-body"},Y={class:"mb-3"},Z=e("label",{for:"title"},"標題",-1),ee={class:"mb-3"},te=e("label",{for:"coupon_code"},"優惠碼",-1),oe={class:"mb-3"},ae=e("label",{for:"due_date"},"到期日",-1),se={class:"mb-3"},ne=e("label",{for:"discount",class:"form-label"},"折扣百分比",-1),le={class:"mb-3"},ie={class:"form-check"},de=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ce=e("button",{type:"submit",class:"btn btn-primary"},"確認",-1),ue=R({__name:"AdminCouponModal",props:{tempCoupon:null},emits:["update-coupon"],setup(x,{expose:p,emit:C}){const t=U(x,"tempCoupon"),c=g(""),{modal:_,showModal:r}=K(c),m=g(""),k=I(()=>V(Date.now()/1e3,"-")),w=g();T(m,n=>{t.value.due_date=H(n)}),T(t,n=>{m.value=V(n.due_date||Date.now()/1e3,"-")},{immediate:!0});const u=()=>{var n,o;(n=w.value)==null||n.resetForm(),(o=_.value)==null||o.hide()};return p({showModal:r,hideModal:u}),(n,o)=>{const l=D("ErrorMessage");return b(),h("div",{id:"couponModal",ref_key:"couponModalRef",ref:c,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[d(i(F),{ref_key:"formRef",ref:w,class:"modal-dialog modal-xl",role:"document",onSubmit:o[5]||(o[5]=q(s=>n.$emit("update-coupon",i(t)),["prevent"]))},{default:A(({errors:s})=>[e("div",G,[e("div",{class:"modal-header bg-dark text-white"},[J,e("button",{type:"button",class:"btn-close btn-close-white","aria-label":"Close",onClick:u})]),e("div",W,[e("div",Y,[Z,d(i(y),{id:"title",modelValue:i(t).title,"onUpdate:modelValue":o[0]||(o[0]=a=>i(t).title=a),name:"title",label:"標題",type:"text",class:v(["form-control",{"is-invalid":s.title}]),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),d(l,{name:"title",class:"invalid-feedback"})]),e("div",ee,[te,d(i(y),{id:"coupon_code",modelValue:i(t).code,"onUpdate:modelValue":o[1]||(o[1]=a=>i(t).code=a),name:"coupon_code",label:"優惠碼",type:"text",class:v(["form-control",{"is-invalid":s.coupon_code}]),placeholder:"請輸入優惠碼",rules:"required|min:4|max:12"},null,8,["modelValue","class"]),d(l,{name:"coupon_code",class:"invalid-feedback"})]),e("div",oe,[ae,d(i(y),{id:"due_date",modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=a=>m.value=a),name:"due_date",label:"到期日",type:"date",class:v(["form-control",{"is-invalid":s.due_date}]),rules:"required",min:i(k)},null,8,["modelValue","class","min"]),d(l,{name:"due_date",class:"invalid-feedback"})]),e("div",se,[ne,d(i(y),{id:"discount",modelValue:i(t).percent,"onUpdate:modelValue":o[3]||(o[3]=a=>i(t).percent=a),modelModifiers:{number:!0},type:"number",class:v(["form-control",{"is-invalid":s.discount}]),name:"discount",label:"折扣百分比",placeholder:"請輸入折扣百分比",min:"1",max:"100",rules:"required|min_value:1|max_value:100"},null,8,["modelValue","class"]),d(l,{name:"discount",class:"invalid-feedback"})]),e("div",le,[e("div",ie,[de,P(e("input",{id:"is_enabled","onUpdate:modelValue":o[4]||(o[4]=a=>i(t).is_enabled=a),as:"my-checkbox",name:"is_enabled",label:"是否啟用",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[S,i(t).is_enabled]])])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:u},"取消"),ce])])])]),_:1},512)],512)}}}),re={class:"container"},me={class:"text-end mt-4"},pe={class:"table mt-4"},_e=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",null,"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),fe={key:0},be={class:"text-end"},he={class:"btn-group"},ve=["onClick"],ge=["onClick"],Ce={class:"d-flex justify-content-center"},we={class:"text-center"},xe=R({__name:"AdminCouponsView",setup(x){const{VITE_URL:p,VITE_PATH:C,VITE_TEXT:L}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=B({coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}),c=g(),_=g(),r=async(n=t.pagination.current_page||1)=>{var l;const o=`${p}/api/${C}/admin/coupons/?page=${n}`;t.isLoading=!0;try{const s=await $.get(o);t.isLoading=!1,t.coupons=s.data.coupons,t.pagination=s.data.pagination}catch(s){t.isLoading=!1,s instanceof M&&alert((l=s.response)==null?void 0:l.data.message)}};O(()=>{r()});const m=()=>{const n=`${p}/api/${C}/admin/coupon`,o=t.isNew?n:`${n}/${t.tempCoupon.id}`;return{method:t.isNew?"post":"put",url:o}},k=async()=>{var l,s;const{method:n,url:o}=m();t.isLoading=!0;try{await $[n](o,{data:t.tempCoupon}),(l=c.value)==null||l.hideModal(),r()}catch(a){t.isLoading=!1,a instanceof M&&alert((s=a.response)==null?void 0:s.data.message)}},w=async()=>{var o,l;const n=`${p}/api/${C}/admin/coupon/${t.tempCoupon.id}`;t.isLoading=!0;try{await $.delete(n),(o=_.value)==null||o.hideModal(),r()}catch(s){t.isLoading=!1,s instanceof M&&alert((l=s.response)==null?void 0:l.data.message)}},u=(n,o={})=>{var l,s,a;switch(n){case"new":t.tempCoupon={due_date:Date.now()/1e3,is_enabled:0},t.isNew=!0,(l=c.value)==null||l.showModal();break;case"edit":t.tempCoupon={...o},t.isNew=!1,(s=c.value)==null||s.showModal();break;case"delete":t.tempCoupon={...o},(a=_.value)==null||a.showModal();break}};return(n,o)=>{var s;const l=D("Loading");return b(),h(E,null,[e("div",re,[e("div",me,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=a=>u("new"))},"建立新的優惠券")]),e("table",pe,[_e,(s=t.coupons)!=null&&s.length?(b(),h("tbody",fe,[(b(!0),h(E,null,j(t.coupons,a=>(b(),h("tr",{key:a.id},[e("td",null,f(a.title),1),e("td",null,f(a.percent),1),e("td",be,f(i(V)(a==null?void 0:a.due_date)),1),e("td",null,[e("span",{class:v({"text-success":a.is_enabled})},f(a.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",he,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:N=>u("edit",a)}," 編輯 ",8,ve),e("button",{class:"btn btn-outline-danger btn-sm",onClick:N=>u("delete",a)}," 刪除 ",8,ge)])])]))),128))])):z("",!0)]),e("div",Ce,[d(Q,{ref:"paginationComponentRef",pagination:t.pagination,onChangePage:r},null,8,["pagination"])]),e("div",we,[e("p",null,f(i(L)),1)])]),d(ue,{ref_key:"couponModalRef",ref:c,"temp-coupon":t.tempCoupon,"is-new":t.isNew,onUpdateCoupon:k},null,8,["temp-coupon","is-new"]),d(X,{ref_key:"deleteModalRef",ref:_,"delete-item":t.tempCoupon,onDeleteItem:w},null,8,["delete-item"]),d(l,{active:t.isLoading,"onUpdate:active":o[1]||(o[1]=a=>t.isLoading=a),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{xe as default};
