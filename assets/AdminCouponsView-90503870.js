import{d as R,t as N,r as C,G as I,H as T,o as h,c as v,e as d,w as q,z as A,h as i,a as D,b as e,I as f,x as g,y as F,l as S,m as B,F as E,n as P,i as H,g as b,q as $,A as V}from"./index-d4ef98da.js";import{f as M,a as O}from"./useDate-df2f2ebb.js";import{u as z}from"./useModal-651c08cd.js";import{_ as X}from"./AdminDeleteModal.vue_vue_type_script_setup_true_lang-cd58678a.js";import{_ as j}from"./PaginationComponent.vue_vue_type_style_index_0_lang-e0f8b313.js";const G={class:"modal-content bcoupon-0"},K=e("h5",{id:"exampleModalLabel",class:"modal-title"},[e("span",null,"新增優惠券")],-1),J={class:"modal-body"},Q={class:"mb-3"},W=e("label",{for:"title"},"標題",-1),Y={class:"mb-3"},Z=e("label",{for:"coupon_code"},"優惠碼",-1),ee={class:"mb-3"},te=e("label",{for:"due_date"},"到期日",-1),oe={class:"mb-3"},ae=e("label",{for:"discount",class:"form-label"},"折扣百分比",-1),se={class:"mb-3"},ne={class:"form-check"},le=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ie=e("button",{type:"submit",class:"btn btn-primary"},"確認",-1),de=R({__name:"AdminCouponModal",props:{tempCoupon:null},emits:["update-coupon"],setup(x,{expose:p,emit:w}){const t=N(x,"tempCoupon"),c=C(""),{modal:_,showModal:r}=z(c),m=C(""),k=I(()=>M(Date.now()/1e3,"-")),y=C();T(m,n=>{t.value.due_date=O(n)}),T(t,n=>{m.value=M(n.due_date||Date.now()/1e3,"-")},{immediate:!0});const u=()=>{var n,o;(n=y.value)==null||n.resetForm(),(o=_.value)==null||o.hide()};return p({showModal:r,hideModal:u}),(n,o)=>{const l=D("ErrorMessage");return h(),v("div",{id:"couponModal",ref_key:"couponModalRef",ref:c,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[d(i(F),{ref_key:"formRef",ref:y,class:"modal-dialog modal-xl",role:"document",onSubmit:o[5]||(o[5]=A(s=>n.$emit("update-coupon",i(t)),["prevent"]))},{default:q(({errors:s})=>[e("div",G,[e("div",{class:"modal-header bg-dark text-white"},[K,e("button",{type:"button",class:"btn-close btn-close-white","aria-label":"Close",onClick:u})]),e("div",J,[e("div",Q,[W,d(i(f),{id:"title",modelValue:i(t).title,"onUpdate:modelValue":o[0]||(o[0]=a=>i(t).title=a),name:"title",label:"標題",type:"text",class:g(["form-control",{"is-invalid":s.title}]),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),d(l,{name:"title",class:"invalid-feedback"})]),e("div",Y,[Z,d(i(f),{id:"coupon_code",modelValue:i(t).code,"onUpdate:modelValue":o[1]||(o[1]=a=>i(t).code=a),name:"coupon_code",label:"優惠碼",type:"text",class:g(["form-control",{"is-invalid":s.coupon_code}]),placeholder:"請輸入優惠碼",rules:"required|min:4|max:12"},null,8,["modelValue","class"]),d(l,{name:"coupon_code",class:"invalid-feedback"})]),e("div",ee,[te,d(i(f),{id:"due_date",modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=a=>m.value=a),name:"due_date",label:"到期日",type:"date",class:g(["form-control",{"is-invalid":s.due_date}]),rules:"required",min:i(k)},null,8,["modelValue","class","min"]),d(l,{name:"due_date",class:"invalid-feedback"})]),e("div",oe,[ae,d(i(f),{id:"discount",modelValue:i(t).percent,"onUpdate:modelValue":o[3]||(o[3]=a=>i(t).percent=a),modelModifiers:{number:!0},type:"number",class:g(["form-control",{"is-invalid":s.discount}]),name:"discount",label:"折扣百分比",placeholder:"請輸入折扣百分比",min:"1",max:"100",rules:"required|min_value:1|max_value:100"},null,8,["modelValue","class"]),d(l,{name:"discount",class:"invalid-feedback"})]),e("div",se,[e("div",ne,[le,d(i(f),{id:"is_enabled",modelValue:i(t).is_enabled,"onUpdate:modelValue":o[4]||(o[4]=a=>i(t).is_enabled=a),name:"is_enabled",label:"是否啟用",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,rules:"required"},null,8,["modelValue"]),d(l,{name:"is_enabled",class:"invalid-feedback"})])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:u},"取消"),ie])])])]),_:1},512)],512)}}}),ce={class:"container"},ue={class:"text-end mt-4"},re={class:"table mt-4"},me=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",null,"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),pe={key:0},_e={class:"text-end"},fe={class:"btn-group"},be=["onClick"],he=["onClick"],ve={class:"d-flex justify-content-center"},ge={class:"text-center"},Ve=R({__name:"AdminCouponsView",setup(x){const{VITE_URL:p,VITE_PATH:w,VITE_TEXT:L}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=S({coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}),c=C(),_=C(),r=async(n=t.pagination.current_page||1)=>{var l;const o=`${p}/api/${w}/admin/coupons/?page=${n}`;t.isLoading=!0;try{const s=await $.get(o);t.isLoading=!1,t.coupons=s.data.coupons,t.pagination=s.data.pagination}catch(s){t.isLoading=!1,s instanceof V&&alert((l=s.response)==null?void 0:l.data.message)}};B(()=>{r()});const m=()=>{const n=`${p}/api/${w}/admin/coupon`,o=t.isNew?n:`${n}/${t.tempCoupon.id}`;return{method:t.isNew?"post":"put",url:o}},k=async()=>{var l,s;const{method:n,url:o}=m();t.isLoading=!0;try{await $[n](o,{data:t.tempCoupon}),(l=c.value)==null||l.hideModal(),r()}catch(a){t.isLoading=!1,a instanceof V&&alert((s=a.response)==null?void 0:s.data.message)}},y=async()=>{var o,l;const n=`${p}/api/${w}/admin/coupon/${t.tempCoupon.id}`;t.isLoading=!0;try{await $.delete(n),(o=_.value)==null||o.hideModal(),r()}catch(s){t.isLoading=!1,s instanceof V&&alert((l=s.response)==null?void 0:l.data.message)}},u=(n,o={})=>{var l,s,a;switch(n){case"new":t.tempCoupon={due_date:Date.now()/1e3,is_enabled:0},t.isNew=!0,(l=c.value)==null||l.showModal();break;case"edit":t.tempCoupon={...o},t.isNew=!1,(s=c.value)==null||s.showModal();break;case"delete":t.tempCoupon={...o},(a=_.value)==null||a.showModal();break}};return(n,o)=>{var s;const l=D("Loading");return h(),v(E,null,[e("div",ce,[e("div",ue,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=a=>u("new"))},"建立新的優惠券")]),e("table",re,[me,(s=t.coupons)!=null&&s.length?(h(),v("tbody",pe,[(h(!0),v(E,null,P(t.coupons,a=>(h(),v("tr",{key:a.id},[e("td",null,b(a.title),1),e("td",null,b(a.percent),1),e("td",_e,b(i(M)(a==null?void 0:a.due_date)),1),e("td",null,[e("span",{class:g({"text-success":a.is_enabled})},b(a.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",fe,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:U=>u("edit",a)}," 編輯 ",8,be),e("button",{class:"btn btn-outline-danger btn-sm",onClick:U=>u("delete",a)}," 刪除 ",8,he)])])]))),128))])):H("",!0)]),e("div",ve,[d(j,{ref:"paginationComponentRef",pagination:t.pagination,onChangePage:r},null,8,["pagination"])]),e("div",ge,[e("p",null,b(i(L)),1)])]),d(de,{ref_key:"couponModalRef",ref:c,"temp-coupon":t.tempCoupon,"is-new":t.isNew,onUpdateCoupon:k},null,8,["temp-coupon","is-new"]),d(X,{ref_key:"deleteModalRef",ref:_,"delete-item":t.tempCoupon,onDeleteItem:y},null,8,["delete-item"]),d(l,{active:t.isLoading,"onUpdate:active":o[1]||(o[1]=a=>t.isLoading=a),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{Ve as default};
