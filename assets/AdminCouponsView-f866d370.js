import{d as R,t as U,r as w,H as N,I as V,o as b,c as f,b as e,j as m,v as g,h as i,G as I,l as A,m as P,F as E,n as B,i as S,e as C,g as _,q as k,A as M,a as H,x as O}from"./index-f10d7621.js";import{f as L,a as j}from"./useDate-df2f2ebb.js";import{u as q}from"./useModal-cc9e8f56.js";import{_ as F}from"./DeleteModal.vue_vue_type_script_setup_true_lang-111ea07f.js";import{P as X}from"./PaginationComponent-93283b55.js";const z={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content bcoupon-0"},K=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"exampleModalLabel",class:"modal-title"},[e("span",null,"新增優惠券")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},Q={class:"mb-3"},W=e("label",{for:"title"},"標題",-1),Y={class:"mb-3"},Z=e("label",{for:"coupon_code"},"優惠碼",-1),ee={class:"mb-3"},te=e("label",{for:"due_date"},"到期日",-1),oe=["min"],se={class:"mb-3"},ne=e("label",{for:"price"},"折扣百分比",-1),ae={class:"mb-3"},le={class:"form-check"},ie=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),de={class:"modal-footer"},ce=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),re=R({__name:"CouponModal",props:{tempCoupon:null},emits:["update-coupon"],setup(T,{expose:p,emit:h}){const t=U(T,"tempCoupon"),c=w(""),{modal:v,showModal:r,hideModal:y}=q(c),u=w(""),$=N(()=>L(Date.now()/1e3,"-"));return V(u,d=>{t.value.due_date=j(d)}),V(t,d=>{u.value=L(d.due_date||Date.now()/1e3,"-")},{immediate:!0}),p({showModal:r,hideModal:y}),(d,s)=>(b(),f("div",{id:"couponModal",ref_key:"couponModalRef",ref:c,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",z,[e("div",G,[K,e("div",J,[e("div",Q,[W,m(e("input",{id:"title","onUpdate:modelValue":s[0]||(s[0]=o=>i(t).title=o),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[g,i(t).title]])]),e("div",Y,[Z,m(e("input",{id:"coupon_code","onUpdate:modelValue":s[1]||(s[1]=o=>i(t).code=o),type:"text",class:"form-control",placeholder:"請輸入優惠碼"},null,512),[[g,i(t).code]])]),e("div",ee,[te,m(e("input",{id:"due_date","onUpdate:modelValue":s[2]||(s[2]=o=>u.value=o),min:i($),type:"date",class:"form-control"},null,8,oe),[[g,u.value]])]),e("div",se,[ne,m(e("input",{id:"price","onUpdate:modelValue":s[3]||(s[3]=o=>i(t).percent=o),type:"number",class:"form-control",min:"0",placeholder:"請輸入折扣百分比"},null,512),[[g,i(t).percent,void 0,{number:!0}]])]),e("div",ae,[e("div",le,[m(e("input",{id:"is_enabled","onUpdate:modelValue":s[4]||(s[4]=o=>i(t).is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[I,i(t).is_enabled]]),ie])])]),e("div",de,[ce,e("button",{type:"button",class:"btn btn-primary",onClick:s[5]||(s[5]=o=>d.$emit("update-coupon",i(t)))}," 修改付款狀態 ")])])])],512))}}),ue={class:"container"},pe={class:"text-end mt-4"},me={class:"table mt-4"},_e=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",null,"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),be={key:0},fe={class:"text-end"},he={class:"btn-group"},ve=["onClick"],ge=["onClick"],Ce={class:"d-flex justify-content-center"},we={class:"text-center"},Te=R({__name:"AdminCouponsView",setup(T){const{VITE_URL:p,VITE_PATH:h,VITE_TEXT:x}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=A({coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}),c=w(),v=w(),r=async(s=t.pagination.current_page||1)=>{var l;const o=`${p}/api/${h}/admin/coupons/?page=${s}`;t.isLoading=!0;try{const a=await k.get(o);t.isLoading=!1,t.coupons=a.data.coupons,t.pagination=a.data.pagination}catch(a){t.isLoading=!1,a instanceof M&&alert((l=a.response)==null?void 0:l.data.message)}};P(()=>{r()});const y=()=>{const s=`${p}/api/${h}/admin/coupon`,o=t.isNew?s:`${s}/${t.tempCoupon.id}`;return{method:t.isNew?"post":"put",url:o}},u=async()=>{var l,a;const{method:s,url:o}=y();t.isLoading=!0;try{await k[s](o,{data:t.tempCoupon}),(l=c.value)==null||l.hideModal(),r()}catch(n){t.isLoading=!1,n instanceof M&&alert((a=n.response)==null?void 0:a.data.message)}},$=async()=>{var o,l;const s=`${p}/api/${h}/admin/coupon/${t.tempCoupon.id}`;t.isLoading=!0;try{await k.delete(s),(o=v.value)==null||o.hideModal(),r()}catch(a){t.isLoading=!1,a instanceof M&&alert((l=a.response)==null?void 0:l.data.message)}},d=(s,o={})=>{var l,a,n;switch(s){case"new":t.tempCoupon={is_enabled:0},t.isNew=!0,(l=c.value)==null||l.showModal();break;case"edit":t.tempCoupon={...o},t.isNew=!1,(a=c.value)==null||a.showModal();break;case"delete":t.tempCoupon={...o},(n=v.value)==null||n.showModal();break}};return(s,o)=>{var a;const l=H("Loading");return b(),f(E,null,[e("div",ue,[e("div",pe,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=n=>d("new"))},"建立新的優惠券")]),e("table",me,[_e,(a=t.coupons)!=null&&a.length?(b(),f("tbody",be,[(b(!0),f(E,null,B(t.coupons,n=>(b(),f("tr",{key:n.id},[e("td",null,_(n.title),1),e("td",null,_(n.percent),1),e("td",fe,_(i(L)(n==null?void 0:n.due_date)),1),e("td",null,[e("span",{class:O({"text-success":n.is_enabled})},_(n.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",he,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:D=>d("edit",n)}," 編輯 ",8,ve),e("button",{class:"btn btn-outline-danger btn-sm",onClick:D=>d("delete",n)}," 刪除 ",8,ge)])])]))),128))])):S("",!0)]),e("div",Ce,[C(X,{ref:"paginationComponentRef",pagination:t.pagination,onChangePage:r},null,8,["pagination"])]),e("div",we,[e("p",null,_(i(x)),1)])]),C(re,{ref_key:"couponModalRef",ref:c,"temp-coupon":t.tempCoupon,"is-new":t.isNew,onUpdateCoupon:u},null,8,["temp-coupon","is-new"]),C(F,{ref_key:"deleteModalRef",ref:v,"delete-item":t.tempCoupon,onDeleteItem:$},null,8,["delete-item"]),C(l,{active:t.isLoading,"onUpdate:active":o[1]||(o[1]=n=>t.isLoading=n),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{Te as default};
