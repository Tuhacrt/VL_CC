import{d as T,q as U,r as M,a as d,c as i,g as t,u as n,t as l,e as R,F as v,y as L,v as D,Q as P,h as I,o as A,k,M as w,N as x,j as N}from"./index-30dfd135.js";import{_ as S}from"./AdminDeleteModal.vue_vue_type_script_setup_true_lang-7766bb83.js";import{f as C}from"./useDate-df2f2ebb.js";import{u as j}from"./useModal-ef71b2ec.js";import{_ as B}from"./PaginationComponent.vue_vue_type_style_index_0_lang-69e541f2.js";import"./productStore-33e5f2e7.js";import"./loadingStore-5d94c5d2.js";const q={class:"modal-dialog modal-xl",role:"document"},F={class:"modal-content border-0"},H=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"exampleModalLabel",class:"modal-title"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},Q={class:"row"},X={class:"col-md-4"},z=t("h3",null,"用戶資料",-1),G={class:"table"},J={key:0},W=t("th",{style:{width:"100px"}},"姓名",-1),Y=t("th",null,"Email",-1),Z=t("th",null,"電話",-1),tt=t("th",null,"地址",-1),et={class:"col-md-8"},st=t("h3",null,"訂單細節",-1),ot={class:"table"},at=t("th",{style:{width:"100px"}},"訂單編號",-1),nt=t("th",null,"下單時間",-1),lt=t("th",null,"付款時間",-1),dt={key:0},it={key:1},rt=t("th",null,"付款狀態",-1),ct={key:0,class:"text-success"},_t={key:1,class:"text-muted"},ut=t("th",null,"總金額",-1),pt=t("h3",null,"選購商品",-1),ht={class:"table"},mt=t("thead",null,[t("tr")],-1),ft={class:"text-end"},bt={class:"d-flex justify-content-end"},yt={class:"form-check"},gt={class:"form-check-label",for:"flexCheckDefault"},kt={key:0},vt={key:1},$t={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),xt=T({__name:"AdminOrderModal",props:{tempOrder:null,isPaid:{type:Boolean}},emits:["update-paid"],setup(O,{expose:f,emit:y}){const a=U(O,"tempOrder"),h=M(""),{showModal:m,hideModal:g}=j(h);return f({showModal:m,hideModal:g}),($,p)=>{var _,r,c;return d(),i("div",{id:"orderModal",ref_key:"orderModalRef",ref:h,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"orderModalLabel","aria-hidden":"true"},[t("div",q,[t("div",F,[H,t("div",K,[t("div",Q,[t("div",X,[z,t("table",G,[n(a).user?(d(),i("tbody",J,[t("tr",null,[W,t("td",null,l(n(a).user.name),1)]),t("tr",null,[Y,t("td",null,l(n(a).user.email),1)]),t("tr",null,[Z,t("td",null,l(n(a).user.tel),1)]),t("tr",null,[tt,t("td",null,l(n(a).user.address),1)])])):R("",!0)])]),t("div",et,[st,t("table",ot,[t("tbody",null,[t("tr",null,[at,t("td",null,l(n(a).id),1)]),t("tr",null,[nt,t("td",null,l(n(C)((_=n(a))==null?void 0:_.create_at)),1)]),t("tr",null,[lt,t("td",null,[(r=n(a))!=null&&r.paid_date?(d(),i("span",dt,l(n(C)((c=n(a))==null?void 0:c.paid_date)),1)):(d(),i("span",it,"尚未付款"))])]),t("tr",null,[rt,t("td",null,[n(a).is_paid?(d(),i("strong",ct,"已付款")):(d(),i("span",_t,"尚未付款"))])]),t("tr",null,[ut,t("td",null,l(n(a).total),1)])])]),pt,t("table",ht,[mt,t("tbody",null,[(d(!0),i(v,null,L(n(a).products,s=>(d(),i("tr",{key:s.id},[t("th",null,l(s.product.title),1),t("td",null,l(s.qty)+" / "+l(s.product.unit),1),t("td",ft,l(s.final_total),1)]))),128))])]),t("div",bt,[t("div",yt,[D(t("input",{id:"flexCheckDefault","onUpdate:modelValue":p[0]||(p[0]=s=>n(a).is_paid=s),class:"form-check-input",type:"checkbox",value:""},null,512),[[P,n(a).is_paid]]),t("label",gt,[n(a).is_paid?(d(),i("span",kt,"已付款")):(d(),i("span",vt,"未付款"))])])])])])]),t("div",$t,[wt,t("button",{type:"button",class:"btn btn-primary",onClick:p[1]||(p[1]=s=>$.$emit("update-paid",n(a)))}," 修改付款狀態 ")])])])],512)}}}),Mt={class:"container"},Lt={class:"table mt-4"},Ct=t("thead",null,[t("tr",null,[t("th",{width:"130"},"購買時間"),t("th",{width:"130"},"會員信箱"),t("th",{width:"130"},"購買款項"),t("th",{width:"130"},"總額"),t("th",{width:"130"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),Ot={key:0},Et={class:"text-end"},Vt={class:"form-check form-switch d-flex justify-content-center"},Tt=["id","onUpdate:modelValue","onChange"],Rt=["for"],Dt={key:0},Pt={key:1},Ut={class:"btn-group"},It=["onClick"],At=["onClick"],Nt={class:"d-flex justify-content-center"},Qt=T({__name:"AdminOrdersView",setup(O){const{VITE_URL:f,VITE_PATH:y}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=I({orders:[],tempOrder:{create_at:Date.now(),is_paid:!1},pagination:{},isLoading:!1,isPaid:!1,isNew:!1}),a=M(),h=M(),m=async(_=e.pagination.current_page||1)=>{var c;const r=`${f}/api/${y}/admin/orders/?page=${_}`;e.isLoading=!0;try{const s=await w.get(r);e.isLoading=!1,e.orders=s.data.orders,e.pagination=s.data.pagination}catch(s){e.isLoading=!1,s instanceof x&&alert((c=s.response)==null?void 0:c.data.message)}};A(()=>{m()});const g=async _=>{var s,o;const r=`${f}/api/${y}/admin/order/${_.id}`,c={...e.tempOrder,is_paid:_.is_paid,paid_date:_.is_paid?Math.floor(Date.now()/1e3):0};e.isLoading=!0;try{await w.put(r,{data:c}),(s=a.value)==null||s.hideModal(),m()}catch(b){e.isLoading=!1,b instanceof x&&alert((o=b.response)==null?void 0:o.data.message)}},$=async()=>{var r,c;const _=`${f}/api/${y}/admin/order/${e.tempOrder.id}`;e.isLoading=!0;try{await w.delete(_),(r=h.value)==null||r.hideModal(),m()}catch(s){e.isLoading=!1,s instanceof x&&alert((c=s.response)==null?void 0:c.data.message)}},p=(_,r)=>{var c,s;switch(_){case"edit":e.tempOrder={...r},e.isPaid=e.tempOrder.is_paid,(c=a.value)==null||c.showModal();break;case"delete":e.tempOrder={...r},(s=h.value)==null||s.showModal();break}};return(_,r)=>{var s;const c=N("Loading");return d(),i(v,null,[t("div",Mt,[t("table",Lt,[Ct,(s=e.orders)!=null&&s.length?(d(),i("tbody",Ot,[(d(!0),i(v,null,L(e.orders,o=>{var b;return d(),i("tr",{key:o.id},[t("td",null,l(n(C)(o==null?void 0:o.create_at)),1),t("td",null,l((b=o.user)==null?void 0:b.email),1),t("td",null,[(d(!0),i(v,null,L(o.products,u=>{var E,V;return d(),i("tr",{key:u.id,class:"d-flex justify-content-start"},[t("td",null,l((E=u.product)==null?void 0:E.title)+" "+l(u.qty)+" "+l((V=u.product)==null?void 0:V.unit),1)])}),128))]),t("td",Et,l(o.total),1),t("td",null,[t("div",Vt,[D(t("input",{id:`paidSwitch${o.id}`,"onUpdate:modelValue":u=>o.is_paid=u,type:"checkbox",class:"form-check-input me-2",onChange:u=>g(o)},null,40,Tt),[[P,o.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${o.id}`},[o.is_paid?(d(),i("span",Dt,"已付款")):(d(),i("span",Pt,"未付款"))],8,Rt)])]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:u=>p("edit",o)}," 檢視 ",8,It),t("button",{class:"btn btn-outline-danger btn-sm",onClick:u=>p("delete",o)}," 刪除 ",8,At)])])])}),128))])):R("",!0)]),t("div",Nt,[k(B,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:m},null,8,["pagination"])])]),k(xt,{ref_key:"orderModalRef",ref:a,"temp-order":e.tempOrder,"is-paid":e.tempOrder.is_paid,onUpdatePaid:r[0]||(r[0]=o=>g(e.tempOrder))},null,8,["temp-order","is-paid"]),k(S,{ref_key:"deleteModalRef",ref:h,"delete-item":e.tempOrder,onDeleteItem:$},null,8,["delete-item"]),k(c,{active:e.isLoading,"onUpdate:active":r[1]||(r[1]=o=>e.isLoading=o),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{Qt as default};
