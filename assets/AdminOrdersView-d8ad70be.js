import{d as T,t as U,r as M,o as d,c as i,b as t,h as n,g as l,i as R,F as v,n as L,j as D,G as P,l as I,m as A,e as k,q as w,A as x,a as S}from"./index-f10d7621.js";import{_ as j}from"./DeleteModal.vue_vue_type_script_setup_true_lang-111ea07f.js";import{f as C}from"./useDate-df2f2ebb.js";import{u as B}from"./useModal-cc9e8f56.js";import{P as N}from"./PaginationComponent-93283b55.js";const q={class:"modal-dialog modal-xl",role:"document"},F={class:"modal-content border-0"},H=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"exampleModalLabel",class:"modal-title"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),G={class:"modal-body"},K={class:"row"},X={class:"col-md-4"},z=t("h3",null,"用戶資料",-1),J={class:"table"},Q={key:0},W=t("th",{style:{width:"100px"}},"姓名",-1),Y=t("th",null,"Email",-1),Z=t("th",null,"電話",-1),tt=t("th",null,"地址",-1),et={class:"col-md-8"},st=t("h3",null,"訂單細節",-1),ot={class:"table"},at=t("th",{style:{width:"100px"}},"訂單編號",-1),nt=t("th",null,"下單時間",-1),lt=t("th",null,"付款時間",-1),dt={key:0},it={key:1},ct=t("th",null,"付款狀態",-1),rt={key:0,class:"text-success"},_t={key:1,class:"text-muted"},ut=t("th",null,"總金額",-1),pt=t("h3",null,"選購商品",-1),ht={class:"table"},mt=t("thead",null,[t("tr")],-1),ft={class:"text-end"},bt={class:"d-flex justify-content-end"},yt={class:"form-check"},gt={class:"form-check-label",for:"flexCheckDefault"},kt={key:0},vt={key:1},$t={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),xt=T({__name:"OrderModal",props:{tempOrder:null,isPaid:{type:Boolean}},emits:["update-paid"],setup(O,{expose:h,emit:b}){const o=U(O,"tempOrder"),p=M(""),{modal:m,showModal:y,hideModal:$}=B(p);return h({showModal:y,hideModal:$}),(g,r)=>{var c,_,a;return d(),i("div",{id:"orderModal",ref_key:"orderModalRef",ref:p,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"orderModalLabel","aria-hidden":"true"},[t("div",q,[t("div",F,[H,t("div",G,[t("div",K,[t("div",X,[z,t("table",J,[n(o).user?(d(),i("tbody",Q,[t("tr",null,[W,t("td",null,l(n(o).user.name),1)]),t("tr",null,[Y,t("td",null,l(n(o).user.email),1)]),t("tr",null,[Z,t("td",null,l(n(o).user.tel),1)]),t("tr",null,[tt,t("td",null,l(n(o).user.address),1)])])):R("",!0)])]),t("div",et,[st,t("table",ot,[t("tbody",null,[t("tr",null,[at,t("td",null,l(n(o).id),1)]),t("tr",null,[nt,t("td",null,l(n(C)((c=n(o))==null?void 0:c.create_at)),1)]),t("tr",null,[lt,t("td",null,[(_=n(o))!=null&&_.paid_date?(d(),i("span",dt,l(n(C)((a=n(o))==null?void 0:a.paid_date)),1)):(d(),i("span",it,"尚未付款"))])]),t("tr",null,[ct,t("td",null,[n(o).is_paid?(d(),i("strong",rt,"已付款")):(d(),i("span",_t,"尚未付款"))])]),t("tr",null,[ut,t("td",null,l(n(o).total),1)])])]),pt,t("table",ht,[mt,t("tbody",null,[(d(!0),i(v,null,L(n(o).products,e=>(d(),i("tr",{key:e.id},[t("th",null,l(e.product.title),1),t("td",null,l(e.qty)+" / "+l(e.product.unit),1),t("td",ft,l(e.final_total),1)]))),128))])]),t("div",bt,[t("div",yt,[D(t("input",{id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=e=>n(o).is_paid=e),class:"form-check-input",type:"checkbox",value:""},null,512),[[P,n(o).is_paid]]),t("label",gt,[n(o).is_paid?(d(),i("span",kt,"已付款")):(d(),i("span",vt,"未付款"))])])])])])]),t("div",$t,[wt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=e=>g.$emit("update-paid",n(o)))}," 修改付款狀態 ")])])])],512)}}}),Mt={class:"container"},Lt={class:"table mt-4"},Ct=t("thead",null,[t("tr",null,[t("th",{width:"130"},"購買時間"),t("th",{width:"130"},"會員信箱"),t("th",{width:"130"},"購買款項"),t("th",{width:"130"},"總額"),t("th",{width:"130"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),Ot={key:0},Et={class:"text-end"},Vt={class:"form-check form-switch d-flex justify-content-center"},Tt=["id","onUpdate:modelValue","onChange"],Rt=["for"],Dt={key:0},Pt={key:1},Ut={class:"btn-group"},It=["onClick"],At=["onClick"],St={class:"d-flex justify-content-center"},Ht=T({__name:"AdminOrdersView",setup(O){const{VITE_URL:h,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},s=I({orders:[],tempOrder:{create_at:Date.now(),is_paid:!1},pagination:{},isLoading:!1,isPaid:!1,isNew:!1}),o=M(),p=M(),m=async(r=s.pagination.current_page||1)=>{var _;const c=`${h}/api/${b}/admin/orders/?page=${r}`;s.isLoading=!0;try{const a=await w.get(c);s.isLoading=!1,s.orders=a.data.orders,s.pagination=a.data.pagination}catch(a){s.isLoading=!1,a instanceof x&&alert((_=a.response)==null?void 0:_.data.message)}};A(()=>{m()});const y=async r=>{var a,e;const c=`${h}/api/${b}/admin/order/${r.id}`,_={...s.tempOrder,is_paid:r.is_paid,paid_date:r.is_paid?Math.floor(Date.now()/1e3):0};s.isLoading=!0;try{await w.put(c,{data:_}),(a=o.value)==null||a.hideModal(),m()}catch(f){s.isLoading=!1,f instanceof x&&alert((e=f.response)==null?void 0:e.data.message)}},$=async()=>{var c,_;const r=`${h}/api/${b}/admin/order/${s.tempOrder.id}`;s.isLoading=!0;try{await w.delete(r),(c=p.value)==null||c.hideModal(),m()}catch(a){s.isLoading=!1,a instanceof x&&alert((_=a.response)==null?void 0:_.data.message)}},g=(r,c)=>{var _,a;switch(r){case"edit":s.tempOrder={...c},s.isPaid=s.tempOrder.is_paid,(_=o.value)==null||_.showModal();break;case"delete":s.tempOrder={...c},(a=p.value)==null||a.showModal();break}};return(r,c)=>{var a;const _=S("Loading");return d(),i(v,null,[t("div",Mt,[t("table",Lt,[Ct,(a=s.orders)!=null&&a.length?(d(),i("tbody",Ot,[(d(!0),i(v,null,L(s.orders,e=>{var f;return d(),i("tr",{key:e.id},[t("td",null,l(n(C)(e==null?void 0:e.create_at)),1),t("td",null,l((f=e.user)==null?void 0:f.email),1),t("td",null,[(d(!0),i(v,null,L(e.products,u=>{var E,V;return d(),i("tr",{key:u.id,class:"d-flex justify-content-start"},[t("td",null,l((E=u.product)==null?void 0:E.title)+" "+l(u.qty)+" "+l((V=u.product)==null?void 0:V.unit),1)])}),128))]),t("td",Et,l(e.total),1),t("td",null,[t("div",Vt,[D(t("input",{id:`paidSwitch${e.id}`,"onUpdate:modelValue":u=>e.is_paid=u,type:"checkbox",class:"form-check-input me-2",onChange:u=>y(e)},null,40,Tt),[[P,e.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${e.id}`},[e.is_paid?(d(),i("span",Dt,"已付款")):(d(),i("span",Pt,"未付款"))],8,Rt)])]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:u=>g("edit",e)}," 檢視 ",8,It),t("button",{class:"btn btn-outline-danger btn-sm",onClick:u=>g("delete",e)}," 刪除 ",8,At)])])])}),128))])):R("",!0)]),t("div",St,[k(N,{ref:"paginationComponentRef",pagination:s.pagination,onChangePage:m},null,8,["pagination"])])]),k(xt,{ref_key:"orderModalRef",ref:o,"temp-order":s.tempOrder,"is-paid":s.tempOrder.is_paid,onUpdatePaid:c[0]||(c[0]=e=>y(s.tempOrder))},null,8,["temp-order","is-paid"]),k(j,{ref_key:"deleteModalRef",ref:p,"delete-item":s.tempOrder,onDeleteItem:$},null,8,["delete-item"]),k(_,{active:s.isLoading,"onUpdate:active":c[1]||(c[1]=e=>s.isLoading=e),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{Ht as default};
