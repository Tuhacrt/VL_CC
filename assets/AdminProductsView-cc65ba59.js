import{d as L,q as E,r as M,a as r,c,g as t,t as b,u as s,F as V,z as T,v as p,x as m,U as R,h as N,o as A,e as I,k as y,P as x,Q as P,j as D,A as B}from"./index-88335d6f.js";import{u as S}from"./useModal-db46e4eb.js";import{_ as z}from"./AdminDeleteModal.vue_vue_type_script_setup_true_lang-7a02366e.js";import{P as O}from"./PaginationComponent-639629ed.js";const j={class:"modal-dialog modal-xl"},q={class:"modal-content"},F={class:"modal-header bg-dark text-white"},H={id:"productModalLabel",class:"modal-title"},X={class:"modal-body"},K={class:"row"},Q={key:0,class:"col-sm-4"},G={class:"mb-3"},J=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),W=["onUpdate:modelValue"],Y=["src","alt"],Z={key:0},tt={key:1},et={key:1},ot={class:"col-sm-8"},st={class:"mb-3"},nt=t("label",{for:"title",class:"form-label"},"標題",-1),lt={class:"row"},at={class:"mb-3 col-md-6"},it=t("label",{for:"category",class:"form-label"},"分類",-1),dt={class:"mb-3 col-md-6"},rt=t("label",{for:"price",class:"form-label"},"單位",-1),ct={class:"row"},ut={class:"mb-3 col-md-6"},pt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),mt={class:"mb-3 col-md-6"},_t=t("label",{for:"price",class:"form-label"},"售價",-1),bt=t("hr",null,null,-1),ft={class:"mb-3"},ht=t("label",{for:"description",class:"form-label"},"產品描述",-1),gt={class:"mb-3"},vt=t("label",{for:"content",class:"form-label"},"說明內容",-1),yt={class:"mb-3"},wt={class:"form-check"},kt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),$t={class:"modal-footer"},Ut=L({__name:"AdminProductModal",props:{tempProduct:null,isNew:{type:Boolean}},emits:["update-product"],setup(w,{expose:h,emit:v}){const e=E(w,"tempProduct"),_=M(""),{showModal:g,hideModal:u}=S(_),k=()=>{e.value.imagesUrl=[""]};return h({showModal:g,hideModal:u}),($,l)=>{var f,d,a,i;return r(),c("div",{id:"productModal",ref_key:"productModalRef",ref:_,class:"modal fade border-0",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[t("div",j,[t("div",q,[t("div",F,[t("h5",H,[t("span",null,b(w.isNew?"新增產品":"編輯產品"),1)]),t("button",{type:"button",class:"btn-close btn-close-white","aria-label":"Close",onClick:l[0]||(l[0]=(...o)=>s(u)&&s(u)(...o))})]),t("div",X,[t("div",K,[Array.isArray((f=s(e))==null?void 0:f.imagesUrl)?(r(),c("div",Q,[(r(!0),c(V,null,T((d=s(e))==null?void 0:d.imagesUrl,(o,n)=>(r(),c("div",{key:n},[t("div",G,[J,p(t("input",{"onUpdate:modelValue":U=>s(e).imagesUrl[n]=U,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,W),[[m,s(e).imagesUrl[n]]])]),t("img",{class:"img-fluid mb-2",src:o,alt:`${o}:${n}`},null,8,Y)]))),128)),((i=s(e))==null?void 0:i.imagesUrl[((a=s(e))==null?void 0:a.imagesUrl.length)-1])!==""?(r(),c("div",Z,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:l[1]||(l[1]=o=>{var n;return(n=s(e))==null?void 0:n.imagesUrl.push("")})}," 新增圖片 ")])):(r(),c("div",tt,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:l[2]||(l[2]=o=>{var n;return(n=s(e))==null?void 0:n.imagesUrl.pop()})}," 刪除圖片 ")]))])):(r(),c("div",et,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:k}," 新增圖片 ")])),t("div",ot,[t("div",st,[nt,p(t("input",{id:"title","onUpdate:modelValue":l[3]||(l[3]=o=>s(e).title=o),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[m,s(e).title]])]),t("div",lt,[t("div",at,[it,p(t("input",{id:"category","onUpdate:modelValue":l[4]||(l[4]=o=>s(e).category=o),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[m,s(e).category]])]),t("div",dt,[rt,p(t("input",{id:"unit","onUpdate:modelValue":l[5]||(l[5]=o=>s(e).unit=o),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[m,s(e).unit]])])]),t("div",ct,[t("div",ut,[pt,p(t("input",{id:"origin_price","onUpdate:modelValue":l[6]||(l[6]=o=>s(e).origin_price=o),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[m,s(e).origin_price,void 0,{number:!0}]])]),t("div",mt,[_t,p(t("input",{id:"price","onUpdate:modelValue":l[7]||(l[7]=o=>s(e).price=o),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[m,s(e).price,void 0,{number:!0}]])])]),bt,t("div",ft,[ht,p(t("textarea",{id:"description","onUpdate:modelValue":l[8]||(l[8]=o=>s(e).description=o),type:"text",class:"form-control",placeholder:"請輸入產品描述"},null,512),[[m,s(e).description]])]),t("div",gt,[vt,p(t("textarea",{id:"description","onUpdate:modelValue":l[9]||(l[9]=o=>s(e).content=o),type:"text",class:"form-control",placeholder:"請輸入說明內容"},null,512),[[m,s(e).content]])]),t("div",yt,[t("div",wt,[p(t("input",{id:"is_enabled","onUpdate:modelValue":l[10]||(l[10]=o=>s(e).is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[R,s(e).is_enabled]]),kt])])])])]),t("div",$t,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:l[11]||(l[11]=(...o)=>s(u)&&s(u)(...o))},"取消"),t("button",{type:"button",class:"btn btn-primary",onClick:l[12]||(l[12]=o=>$.$emit("update-product",s(e)))}," 確認 ")])])])],512)}}}),xt={class:"container"},Pt={class:"text-end mt-4"},Mt={class:"table mt-4"},Vt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Ct={key:0},Lt={class:"text-end"},Tt={class:"text-end"},Et={class:"btn-group"},Rt=["onClick"],Nt=["onClick"],At={class:"d-flex justify-content-center"},It={class:"text-center"},Ot=L({__name:"AdminProductsView",setup(w){const{VITE_URL:h,VITE_PATH:v,VITE_TEXT:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=N({products:[],pagination:{},tempProduct:{},isNew:!1,isLoading:!1}),_=M(),g=M(),u=async(d=e.pagination.current_page||1)=>{var i;const a=`${h}/api/${v}/admin/products/?page=${d}`;e.isLoading=!0;try{const o=await x.get(a);e.isLoading=!1,e.products=o.data.products,e.pagination=o.data.pagination}catch(o){e.isLoading=!1,o instanceof P&&alert((i=o.response)==null?void 0:i.data.message)}};A(()=>{u()});const k=()=>{const d=`${h}/api/${v}/admin/product`,a=e.isNew?d:`${d}/${e.tempProduct.id}`;return{method:e.isNew?"post":"put",url:a}},$=async()=>{var i,o;const{method:d,url:a}=k();e.isLoading=!0;try{await x[d](a,{data:e.tempProduct}),(i=_.value)==null||i.hideModal(),u()}catch(n){n instanceof P&&alert((o=n.response)==null?void 0:o.data.message)}},l=async()=>{var a,i;const d=`${h}/api/${v}/admin/product/${e.tempProduct.id}`;e.isLoading=!0;try{await x.delete(d),(a=g.value)==null||a.hideModal(),u()}catch(o){e.isLoading=!1,o instanceof P&&alert((i=o.response)==null?void 0:i.data.message)}},f=(d,a={})=>{var i,o,n;switch(d){case"new":e.tempProduct={imagesUrl:[]},e.isNew=!0,(i=_.value)==null||i.showModal();break;case"edit":e.tempProduct={...a},e.isNew=!1,(o=_.value)==null||o.showModal();break;case"delete":e.tempProduct={...a},(n=g.value)==null||n.showModal();break}};return(d,a)=>{var o;const i=D("Loading");return r(),c(V,null,[t("div",xt,[t("div",Pt,[t("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=n=>f("new"))},"建立新的產品")]),t("table",Mt,[Vt,(o=e.products)!=null&&o.length?(r(),c("tbody",Ct,[(r(!0),c(V,null,T(e.products,n=>(r(),c("tr",{key:n.id},[t("td",null,b(n.category),1),t("td",null,b(n.title),1),t("td",Lt,b(n.origin_price),1),t("td",Tt,b(n.price),1),t("td",null,[t("span",{class:B({"text-success":n.is_enabled})},b(n.is_enabled?"啟用":"未啟用"),3)]),t("td",null,[t("div",Et,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:U=>f("edit",n)}," 編輯 ",8,Rt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:U=>f("delete",n)}," 刪除 ",8,Nt)])])]))),128))])):I("",!0)]),t("div",At,[y(O,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:u},null,8,["pagination"])]),t("div",It,[t("p",null,b(s(C)),1)])]),y(Ut,{ref_key:"productModalRef",ref:_,"temp-product":e.tempProduct,"is-new":e.isNew,onUpdateProduct:$},null,8,["temp-product","is-new"]),y(z,{ref_key:"deleteModalRef",ref:g,"delete-item":e.tempProduct,onDeleteItem:l},null,8,["delete-item"]),y(i,{active:e.isLoading,"onUpdate:active":a[1]||(a[1]=n=>e.isLoading=n),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{Ot as default};
