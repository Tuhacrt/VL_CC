import{d as L,t as R,r as P,o as c,c as u,b as t,g as f,h as l,F as V,n as T,j as p,v as m,G as N,l as I,m as A,i as D,e as w,q as x,A as M,a as B,x as S}from"./index-f10d7621.js";import{u as O}from"./useModal-cc9e8f56.js";import{_ as j}from"./DeleteModal.vue_vue_type_script_setup_true_lang-111ea07f.js";import{P as q}from"./PaginationComponent-93283b55.js";const z={class:"modal-dialog modal-xl"},F={class:"modal-content"},H={class:"modal-header bg-dark text-white"},X={id:"productModalLabel",class:"modal-title"},G={class:"modal-body"},K={class:"row"},J={key:0,class:"col-sm-4"},Q={class:"mb-3"},W=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),Y=["onUpdate:modelValue"],Z=["src","alt"],tt={key:0},et={key:1},ot={key:1},st={class:"col-sm-8"},lt={class:"mb-3"},nt=t("label",{for:"title",class:"form-label"},"標題",-1),at={class:"row"},it={class:"mb-3 col-md-6"},dt=t("label",{for:"category",class:"form-label"},"分類",-1),rt={class:"mb-3 col-md-6"},ct=t("label",{for:"price",class:"form-label"},"單位",-1),ut={class:"row"},pt={class:"mb-3 col-md-6"},mt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),_t={class:"mb-3 col-md-6"},bt=t("label",{for:"price",class:"form-label"},"售價",-1),ft=t("hr",null,null,-1),ht={class:"mb-3"},gt=t("label",{for:"description",class:"form-label"},"產品描述",-1),vt={class:"mb-3"},yt=t("label",{for:"content",class:"form-label"},"說明內容",-1),wt={class:"mb-3"},$t={class:"form-check"},kt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ut={class:"modal-footer"},xt=L({__name:"ProductModal",props:{tempProduct:null,isNew:{type:Boolean}},emits:["update-product"],setup($,{expose:g,emit:v}){const e=R($,"tempProduct"),_=P(""),{modal:y,showModal:h,hideModal:b}=O(_),k=()=>{e.value.imagesUrl=[""]};return g({showModal:h,hideModal:b}),(U,s)=>{var d,a,i,n;return c(),u("div",{id:"productModal",ref_key:"productModalRef",ref:_,class:"modal fade border-0",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[t("div",z,[t("div",F,[t("div",H,[t("h5",X,[t("span",null,f($.isNew?"新增產品":"編輯產品"),1)]),t("button",{type:"button",class:"btn-close btn-close-white","aria-label":"Close",onClick:s[0]||(s[0]=(...o)=>l(b)&&l(b)(...o))})]),t("div",G,[t("div",K,[Array.isArray((d=l(e))==null?void 0:d.imagesUrl)?(c(),u("div",J,[(c(!0),u(V,null,T((a=l(e))==null?void 0:a.imagesUrl,(o,r)=>(c(),u("div",{key:r},[t("div",Q,[W,p(t("input",{"onUpdate:modelValue":E=>l(e).imagesUrl[r]=E,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,Y),[[m,l(e).imagesUrl[r]]])]),t("img",{class:"img-fluid mb-2",src:o,alt:`${o}:${r}`},null,8,Z)]))),128)),((n=l(e))==null?void 0:n.imagesUrl[((i=l(e))==null?void 0:i.imagesUrl.length)-1])!==""?(c(),u("div",tt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[1]||(s[1]=o=>{var r;return(r=l(e))==null?void 0:r.imagesUrl.push("")})}," 新增圖片 ")])):(c(),u("div",et,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:s[2]||(s[2]=o=>{var r;return(r=l(e))==null?void 0:r.imagesUrl.pop()})}," 刪除圖片 ")]))])):(c(),u("div",ot,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:k}," 新增圖片 ")])),t("div",st,[t("div",lt,[nt,p(t("input",{id:"title","onUpdate:modelValue":s[3]||(s[3]=o=>l(e).title=o),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[m,l(e).title]])]),t("div",at,[t("div",it,[dt,p(t("input",{id:"category","onUpdate:modelValue":s[4]||(s[4]=o=>l(e).category=o),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[m,l(e).category]])]),t("div",rt,[ct,p(t("input",{id:"unit","onUpdate:modelValue":s[5]||(s[5]=o=>l(e).unit=o),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[m,l(e).unit]])])]),t("div",ut,[t("div",pt,[mt,p(t("input",{id:"origin_price","onUpdate:modelValue":s[6]||(s[6]=o=>l(e).origin_price=o),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[m,l(e).origin_price,void 0,{number:!0}]])]),t("div",_t,[bt,p(t("input",{id:"price","onUpdate:modelValue":s[7]||(s[7]=o=>l(e).price=o),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[m,l(e).price,void 0,{number:!0}]])])]),ft,t("div",ht,[gt,p(t("textarea",{id:"description","onUpdate:modelValue":s[8]||(s[8]=o=>l(e).description=o),type:"text",class:"form-control",placeholder:"請輸入產品描述"},null,512),[[m,l(e).description]])]),t("div",vt,[yt,p(t("textarea",{id:"description","onUpdate:modelValue":s[9]||(s[9]=o=>l(e).content=o),type:"text",class:"form-control",placeholder:"請輸入說明內容"},null,512),[[m,l(e).content]])]),t("div",wt,[t("div",$t,[p(t("input",{id:"is_enabled","onUpdate:modelValue":s[10]||(s[10]=o=>l(e).is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[N,l(e).is_enabled]]),kt])])])])]),t("div",Ut,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:s[11]||(s[11]=(...o)=>l(b)&&l(b)(...o))},"取消"),t("button",{type:"button",class:"btn btn-primary",onClick:s[12]||(s[12]=o=>U.$emit("update-product",l(e)))}," 確認 ")])])])],512)}}}),Mt={class:"container"},Pt={class:"text-end mt-4"},Vt={class:"table mt-4"},Ct=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Lt={key:0},Tt={class:"text-end"},Et={class:"text-end"},Rt={class:"btn-group"},Nt=["onClick"],It=["onClick"],At={class:"d-flex justify-content-center"},Dt={class:"text-center"},qt=L({__name:"AdminProductsView",setup($){const{VITE_URL:g,VITE_PATH:v,VITE_TEXT:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=I({products:[],pagination:{},tempProduct:{},isNew:!1,isLoading:!1}),_=P(),y=P(),h=async(d=e.pagination.current_page||1)=>{var i;const a=`${g}/api/${v}/admin/products/?page=${d}`;e.isLoading=!0;try{const n=await x.get(a);e.isLoading=!1,e.products=n.data.products,e.pagination=n.data.pagination}catch(n){e.isLoading=!1,n instanceof M&&alert((i=n.response)==null?void 0:i.data.message)}};A(()=>{h()});const b=()=>{const d=`${g}/api/${v}/admin/product`,a=e.isNew?d:`${d}/${e.tempProduct.id}`;return{method:e.isNew?"post":"put",url:a}},k=async()=>{var i,n;const{method:d,url:a}=b();e.isLoading=!0;try{await x[d](a,{data:e.tempProduct}),(i=_.value)==null||i.hideModal(),h()}catch(o){o instanceof M&&alert((n=o.response)==null?void 0:n.data.message)}},U=async()=>{var a,i;const d=`${g}/api/${v}/admin/product/${e.tempProduct.id}`;e.isLoading=!0;try{await x.delete(d),(a=y.value)==null||a.hideModal(),h()}catch(n){e.isLoading=!1,n instanceof M&&alert((i=n.response)==null?void 0:i.data.message)}},s=(d,a={})=>{var i,n,o;switch(d){case"new":e.tempProduct={imagesUrl:[]},e.isNew=!0,(i=_.value)==null||i.showModal();break;case"edit":e.tempProduct={...a},e.isNew=!1,(n=_.value)==null||n.showModal();break;case"delete":e.tempProduct={...a},(o=y.value)==null||o.showModal();break}};return(d,a)=>{var n;const i=B("Loading");return c(),u(V,null,[t("div",Mt,[t("div",Pt,[t("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=o=>s("new"))},"建立新的產品")]),t("table",Vt,[Ct,(n=e.products)!=null&&n.length?(c(),u("tbody",Lt,[(c(!0),u(V,null,T(e.products,o=>(c(),u("tr",{key:o.id},[t("td",null,f(o.category),1),t("td",null,f(o.title),1),t("td",Tt,f(o.origin_price),1),t("td",Et,f(o.price),1),t("td",null,[t("span",{class:S({"text-success":o.is_enabled})},f(o.is_enabled?"啟用":"未啟用"),3)]),t("td",null,[t("div",Rt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>s("edit",o)}," 編輯 ",8,Nt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>s("delete",o)}," 刪除 ",8,It)])])]))),128))])):D("",!0)]),t("div",At,[w(q,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:h},null,8,["pagination"])]),t("div",Dt,[t("p",null,f(l(C)),1)])]),w(xt,{ref_key:"productModalRef",ref:_,"temp-product":e.tempProduct,"is-new":e.isNew,onUpdateProduct:k},null,8,["temp-product","is-new"]),w(j,{ref_key:"deleteModalRef",ref:y,"delete-item":e.tempProduct,onDeleteItem:U},null,8,["delete-item"]),w(i,{active:e.isLoading,"onUpdate:active":a[1]||(a[1]=o=>e.isLoading=o),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{qt as default};
