import{d as R,r as A,l as F,m as M,o as r,c,b as e,F as w,n as N,i as T,g as _,e as i,w as S,h as B,q as b,A as h,a as v,f as O,j as D,v as P,x as y,y as j}from"./index-d4ef98da.js";const H={class:"container"},z={class:"mt-4"},K={class:"text-end"},X=["disabled"],G={key:0,class:"h1 text-white font-weight-bold bg-dark"},J={key:1,class:"table align-middle"},Q=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),W=["disabled","onClick"],Y=e("div",null,"移除購物車",-1),Z=[Y],ee={key:0,class:"text-success"},se={class:"input-group input-group-sm"},te={class:"input-group mb-3"},ae=["onUpdate:modelValue","disabled","onChange"],oe={id:"basic-addon2",class:"input-group-text"},le={class:"text-end"},ne={key:0,class:"text-success"},de={key:1},ie={key:0},re=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ce={class:"text-end text-success"},ue={key:1},me=e("td",{colspan:"3",class:"text-end"},"總計",-1),_e={class:"text-end"},pe={class:"my-5 row justify-content-center"},fe={class:"mb-3"},ge=e("label",{for:"email",class:"form-label"},"Email",-1),be={class:"mb-3"},he=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ye={class:"mb-3"},ve=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Ve={class:"mb-3"},xe=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Le={class:"mb-3"},ke=e("label",{for:"message",class:"form-label"},"留言",-1),Ee={class:"text-end"},Ce=["disabled"],$e=R({__name:"UserCartView",setup(we){const{VITE_URL:p,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},V=A(),s=F({cart:{},form:{user:{},message:""},isLoading:!1}),g=async()=>{var t;const n=`${p}/api/${f}/cart`;s.isLoading=!0;try{const a=await b.get(n);s.isLoading=!1,s.cart=a.data.data}catch(a){s.isLoading=!1,a instanceof h&&alert((t=a.response)==null?void 0:t.data.message)}},$=async n=>{var l;const t=`${p}/api/${f}/cart/${n.id}`,a={product_id:n.id,qty:n.qty};s.isLoading=!0;try{const d=await b.put(t,{data:a});s.isLoading=!1,alert(d.data.message),g()}catch(d){d instanceof h&&alert((l=d.response)==null?void 0:l.data.message)}},U=async()=>{var t;const n=`${p}/api/${f}/carts`;s.isLoading=!0;try{const a=await b.delete(n);s.isLoading=!1,alert(a.data.message),g()}catch(a){a instanceof h&&alert((t=a.response)==null?void 0:t.data.message)}},q=async n=>{var a;const t=`${p}/api/${f}/cart/${n}`;s.isLoading=!0;try{const l=await b.delete(t);s.isLoading=!1,alert(l.data.message),g()}catch(l){s.isLoading=!1,l instanceof h&&alert((a=l.response)==null?void 0:a.data.message)}},I=async()=>{var a,l;const n=`${p}/api/${f}/order`,t=s.form;s.isLoading=!0;try{const d=await b.post(n,{data:t});(a=V.value)==null||a.resetForm(),alert(d.data.message),g()}catch(d){s.isLoading=!1,d instanceof h&&alert((l=d.response)==null?void 0:l.data.message)}};return M(()=>{g()}),(n,t)=>{var x,L,k,E,C;const a=v("Field"),l=v("ErrorMessage"),d=v("Loading");return r(),c(w,null,[e("div",H,[e("div",z,[e("div",K,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:!((L=(x=s.cart)==null?void 0:x.carts)!=null&&L.length),onClick:U}," 清空購物車 ",8,X)]),(E=(k=s.cart)==null?void 0:k.carts)!=null&&E.length?(r(),c("table",J,[Q,e("tbody",null,[(C=s.cart)!=null&&C.carts?(r(!0),c(w,{key:0},N(s.cart.carts,o=>(r(),c("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:s.isLoading,onClick:m=>q(o.id)},Z,8,W)]),e("td",null,[O(_(o.product.title)+" ",1),o.product.price<o.product.origin_price?(r(),c("div",ee," 已套用優惠券 ")):T("",!0)]),e("td",null,[e("div",se,[e("div",te,[D(e("input",{"onUpdate:modelValue":m=>o.qty=m,"aria-label":"qty-input",min:"1",type:"number",class:"form-control",disabled:s.isLoading,onChange:m=>$(o)},null,40,ae),[[P,o.qty,void 0,{number:!0}]]),e("span",oe,_(o.product.unit),1)])])]),e("td",le,[o.product.price<o.product.origin_price?(r(),c("small",ne,"折扣價："+_(o.final_total),1)):(r(),c("small",de,_(o.total),1))])]))),128)):T("",!0)]),e("tfoot",null,[s.cart.final_total<s.cart.total?(r(),c("tr",ie,[re,e("td",ce,_(s.cart.final_total),1)])):(r(),c("tr",ue,[me,e("td",_e,_(s.cart.total),1)]))])])):(r(),c("div",G," 購物車是空的喔！ "))]),e("div",pe,[i(B(j),{ref_key:"formRef",ref:V,class:"col-md-6",onSubmit:I},{default:S(({errors:o})=>{var m;return[e("div",fe,[ge,i(a,{id:"email",modelValue:s.form.user.email,"onUpdate:modelValue":t[0]||(t[0]=u=>s.form.user.email=u),name:"email",label:"Email",type:"email",class:y(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"required|email"},null,8,["modelValue","class"]),i(l,{name:"email",class:"invalid-feedback"})]),e("div",be,[he,i(a,{id:"name",modelValue:s.form.user.name,"onUpdate:modelValue":t[1]||(t[1]=u=>s.form.user.name=u),name:"name",label:"姓名",type:"text",class:y(["form-control",{"is-invalid":o.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),i(l,{name:"name",class:"invalid-feedback"})]),e("div",ye,[ve,i(a,{id:"tel",modelValue:s.form.user.tel,"onUpdate:modelValue":t[2]||(t[2]=u=>s.form.user.tel=u),name:"tel",label:"電話",type:"tel",class:y(["form-control",{"is-invalid":o.tel}]),placeholder:"請輸入電話",rules:"required|min:8|max:10"},null,8,["modelValue","class"]),i(l,{name:"tel",class:"invalid-feedback"})]),e("div",Ve,[xe,i(a,{id:"address",modelValue:s.form.user.address,"onUpdate:modelValue":t[3]||(t[3]=u=>s.form.user.address=u),name:"address",label:"地址",type:"text",class:y(["form-control",{"is-invalid":o.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),i(l,{name:"address",class:"invalid-feedback"})]),e("div",Le,[ke,i(a,{id:"message",modelValue:s.form.message,"onUpdate:modelValue":t[4]||(t[4]=u=>s.form.message=u),name:"message",as:"textarea",class:"form-control",cols:"30",rows:"10"},null,8,["modelValue"])]),e("div",Ee,[e("button",{type:"submit",class:"btn btn-danger",disabled:!((m=s.cart)!=null&&m.total)||s.isLoading}," 送出訂單 ",8,Ce)])]}),_:1},512)])]),i(d,{active:s.isLoading,"onUpdate:active":t[5]||(t[5]=o=>s.isLoading=o),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{$e as default};
