import{d as M,r as U,s as w,a as n,c as d,g as e,u as t,F as L,y as B,e as R,t as b,k as o,l as O,n as P,M as $,N as j,j as f,b as H,v as z,x as K,P as v,Q}from"./index-eb0e9c0c.js";import{u as X}from"./cartStore-03278271.js";import{u as G}from"./loadingStore-ee469167.js";const J={class:"container"},W={class:"mt-4"},Y={class:"text-end"},Z=["disabled"],ee={key:0,class:"h1 text-white font-weight-bold bg-dark"},se={key:1,class:"table align-middle"},te=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),le=["disabled","onClick"],ae=e("div",null,"移除購物車",-1),oe=[ae],ne={key:0,class:"text-success"},de={class:"input-group input-group-sm"},ie={class:"input-group mb-3"},re=["onUpdate:modelValue","disabled","onChange"],ce={id:"basic-addon2",class:"input-group-text"},ue={class:"text-end"},me={key:0,class:"text-success"},_e={key:1},pe={key:0},be=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ve={class:"text-end text-success"},fe={key:1},he=e("td",{colspan:"3",class:"text-end"},"總計",-1),ge={class:"text-end"},Ve={class:"my-5 row justify-content-center"},ye={class:"mb-3"},xe=e("label",{for:"email",class:"form-label"},"Email",-1),ke={class:"mb-3"},Ee=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ce={class:"mb-3"},Te=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Ue={class:"mb-3"},we=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Le={class:"mb-3"},Re=e("label",{for:"message",class:"form-label"},"留言",-1),Se={class:"text-end"},qe=["disabled"],De=M({__name:"UserCartView",setup(Ie){const{VITE_URL:S,VITE_PATH:q}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},h=U(),I=G(),{isLoading:i}=w(I),g=X(),{getCart:F,updateCart:N,deleteAllCarts:V,deleteCartItem:A}=g,{carts:r}=w(g),a=U({user:{},message:""}),D=async()=>{var u,m;const y=`${S}/api/${q}/order`,l=a.value;i.value=!0;try{const _=await $.post(y,{data:l});i.value=!1,(u=h.value)==null||u.resetForm(),alert(_.data.message),F()}catch(_){i.value=!1,_ instanceof j&&alert((m=_.response)==null?void 0:m.data.message)}};return(y,l)=>{var x,k,E,C,T;const u=f("Field"),m=f("ErrorMessage"),_=f("Loading");return n(),d(L,null,[e("div",J,[e("div",W,[e("div",Y,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:!((k=(x=t(r))==null?void 0:x.carts)!=null&&k.length),onClick:l[0]||(l[0]=(...s)=>t(V)&&t(V)(...s))}," 清空購物車 ",8,Z)]),(C=(E=t(r))==null?void 0:E.carts)!=null&&C.length?(n(),d("table",se,[te,e("tbody",null,[(T=t(r))!=null&&T.carts?(n(!0),d(L,{key:0},B(t(r).carts,s=>(n(),d("tr",{key:s.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:t(i),onClick:p=>t(A)(s.id)},oe,8,le)]),e("td",null,[H(b(s.product.title)+" ",1),s.product.price<s.product.origin_price?(n(),d("div",ne," 已套用優惠券 ")):R("",!0)]),e("td",null,[e("div",de,[e("div",ie,[z(e("input",{"onUpdate:modelValue":p=>s.qty=p,"aria-label":"qty-input",min:"1",type:"number",class:"form-control",disabled:t(i),onChange:p=>t(N)(s)},null,40,re),[[K,s.qty,void 0,{number:!0}]]),e("span",ce,b(s.product.unit),1)])])]),e("td",ue,[s.product.price<s.product.origin_price?(n(),d("small",me,"折扣價："+b(s.final_total),1)):(n(),d("small",_e,b(s.total),1))])]))),128)):R("",!0)]),e("tfoot",null,[t(r).final_total<t(r).total?(n(),d("tr",pe,[be,e("td",ve,b(t(r).final_total),1)])):(n(),d("tr",fe,[he,e("td",ge,b(t(r).total),1)]))])])):(n(),d("div",ee," 購物車是空的喔！ "))]),e("div",Ve,[o(t(Q),{ref_key:"formRef",ref:h,class:"col-md-6",onSubmit:D},{default:O(({errors:s})=>{var p;return[e("div",ye,[xe,o(u,{id:"email",modelValue:a.value.user.email,"onUpdate:modelValue":l[1]||(l[1]=c=>a.value.user.email=c),name:"email",label:"Email",type:"email",class:v(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"required|email"},null,8,["modelValue","class"]),o(m,{name:"email",class:"invalid-feedback"})]),e("div",ke,[Ee,o(u,{id:"name",modelValue:a.value.user.name,"onUpdate:modelValue":l[2]||(l[2]=c=>a.value.user.name=c),name:"name",label:"姓名",type:"text",class:v(["form-control",{"is-invalid":s.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),o(m,{name:"name",class:"invalid-feedback"})]),e("div",Ce,[Te,o(u,{id:"tel",modelValue:a.value.user.tel,"onUpdate:modelValue":l[3]||(l[3]=c=>a.value.user.tel=c),name:"tel",label:"電話",type:"tel",class:v(["form-control",{"is-invalid":s.tel}]),placeholder:"請輸入電話",rules:"required|min:8|max:10"},null,8,["modelValue","class"]),o(m,{name:"tel",class:"invalid-feedback"})]),e("div",Ue,[we,o(u,{id:"address",modelValue:a.value.user.address,"onUpdate:modelValue":l[4]||(l[4]=c=>a.value.user.address=c),name:"address",label:"地址",type:"text",class:v(["form-control",{"is-invalid":s.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),o(m,{name:"address",class:"invalid-feedback"})]),e("div",Le,[Re,o(u,{id:"message",modelValue:a.value.message,"onUpdate:modelValue":l[5]||(l[5]=c=>a.value.message=c),name:"message",as:"textarea",class:"form-control",cols:"30",rows:"10"},null,8,["modelValue"])]),e("div",Se,[e("button",{type:"submit",class:"btn btn-danger",disabled:!((p=t(r))!=null&&p.total)||t(i)}," 送出訂單 ",8,qe)])]}),_:1},512)])]),o(_,{active:t(i),"onUpdate:active":l[6]||(l[6]=s=>P(i)?i.value=s:null),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{De as default};
