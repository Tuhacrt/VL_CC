import{d as F,r as M,s as N,h as S,o as A,a as n,c as d,g as e,u as a,F as T,H as B,e as U,t as p,k as l,l as O,I as $,J as H,j as b,b as P,D as j,E as z,M as f,N as J}from"./index-ee626469.js";import{u as K}from"./cartStore-6a32536c.js";const X={class:"container"},G={class:"mt-4"},Q={class:"text-end"},W=["disabled"],Y={key:0,class:"h1 text-white font-weight-bold bg-dark"},Z={key:1,class:"table align-middle"},ee=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),se=["disabled","onClick"],te=e("div",null,"移除購物車",-1),oe=[te],ae={key:0,class:"text-success"},le={class:"input-group input-group-sm"},ne={class:"input-group mb-3"},de=["onUpdate:modelValue","disabled","onChange"],ie={id:"basic-addon2",class:"input-group-text"},re={class:"text-end"},ce={key:0,class:"text-success"},ue={key:1},me={key:0},_e=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),pe={class:"text-end text-success"},fe={key:1},be=e("td",{colspan:"3",class:"text-end"},"總計",-1),he={class:"text-end"},ge={class:"my-5 row justify-content-center"},ve={class:"mb-3"},Ve=e("label",{for:"email",class:"form-label"},"Email",-1),ye={class:"mb-3"},xe=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ke={class:"mb-3"},Ee=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Ce={class:"mb-3"},Le=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Te={class:"mb-3"},Ue=e("label",{for:"message",class:"form-label"},"留言",-1),we={class:"text-end"},Ie=["disabled"],Fe=F({__name:"UserCartView",setup(Re){const{VITE_URL:w,VITE_PATH:I}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},h=M(),g=K(),{getCart:v,updateCart:R,deleteAllCarts:V,deleteCartItem:q}=g,{carts:i}=N(g),t=S({form:{user:{},message:""},isLoading:!1}),D=async()=>{var c,u;const y=`${w}/api/${I}/order`,o=t.form;t.isLoading=!0;try{const m=await $.post(y,{data:o});t.isLoading=!1,(c=h.value)==null||c.resetForm(),alert(m.data.message),v()}catch(m){t.isLoading=!1,m instanceof H&&alert((u=m.response)==null?void 0:u.data.message)}};return A(()=>{v()}),(y,o)=>{var x,k,E,C,L;const c=b("Field"),u=b("ErrorMessage"),m=b("Loading");return n(),d(T,null,[e("div",X,[e("div",G,[e("div",Q,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:!((k=(x=a(i))==null?void 0:x.carts)!=null&&k.length),onClick:o[0]||(o[0]=(...s)=>a(V)&&a(V)(...s))}," 清空購物車 ",8,W)]),(C=(E=a(i))==null?void 0:E.carts)!=null&&C.length?(n(),d("table",Z,[ee,e("tbody",null,[(L=a(i))!=null&&L.carts?(n(!0),d(T,{key:0},B(a(i).carts,s=>(n(),d("tr",{key:s.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:t.isLoading,onClick:_=>a(q)(s.id)},oe,8,se)]),e("td",null,[P(p(s.product.title)+" ",1),s.product.price<s.product.origin_price?(n(),d("div",ae," 已套用優惠券 ")):U("",!0)]),e("td",null,[e("div",le,[e("div",ne,[j(e("input",{"onUpdate:modelValue":_=>s.qty=_,"aria-label":"qty-input",min:"1",type:"number",class:"form-control",disabled:t.isLoading,onChange:_=>a(R)(s)},null,40,de),[[z,s.qty,void 0,{number:!0}]]),e("span",ie,p(s.product.unit),1)])])]),e("td",re,[s.product.price<s.product.origin_price?(n(),d("small",ce,"折扣價："+p(s.final_total),1)):(n(),d("small",ue,p(s.total),1))])]))),128)):U("",!0)]),e("tfoot",null,[a(i).final_total<a(i).total?(n(),d("tr",me,[_e,e("td",pe,p(a(i).final_total),1)])):(n(),d("tr",fe,[be,e("td",he,p(a(i).total),1)]))])])):(n(),d("div",Y," 購物車是空的喔！ "))]),e("div",ge,[l(a(J),{ref_key:"formRef",ref:h,class:"col-md-6",onSubmit:D},{default:O(({errors:s})=>{var _;return[e("div",ve,[Ve,l(c,{id:"email",modelValue:t.form.user.email,"onUpdate:modelValue":o[1]||(o[1]=r=>t.form.user.email=r),name:"email",label:"Email",type:"email",class:f(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"required|email"},null,8,["modelValue","class"]),l(u,{name:"email",class:"invalid-feedback"})]),e("div",ye,[xe,l(c,{id:"name",modelValue:t.form.user.name,"onUpdate:modelValue":o[2]||(o[2]=r=>t.form.user.name=r),name:"name",label:"姓名",type:"text",class:f(["form-control",{"is-invalid":s.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),l(u,{name:"name",class:"invalid-feedback"})]),e("div",ke,[Ee,l(c,{id:"tel",modelValue:t.form.user.tel,"onUpdate:modelValue":o[3]||(o[3]=r=>t.form.user.tel=r),name:"tel",label:"電話",type:"tel",class:f(["form-control",{"is-invalid":s.tel}]),placeholder:"請輸入電話",rules:"required|min:8|max:10"},null,8,["modelValue","class"]),l(u,{name:"tel",class:"invalid-feedback"})]),e("div",Ce,[Le,l(c,{id:"address",modelValue:t.form.user.address,"onUpdate:modelValue":o[4]||(o[4]=r=>t.form.user.address=r),name:"address",label:"地址",type:"text",class:f(["form-control",{"is-invalid":s.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),l(u,{name:"address",class:"invalid-feedback"})]),e("div",Te,[Ue,l(c,{id:"message",modelValue:t.form.message,"onUpdate:modelValue":o[5]||(o[5]=r=>t.form.message=r),name:"message",as:"textarea",class:"form-control",cols:"30",rows:"10"},null,8,["modelValue"])]),e("div",we,[e("button",{type:"submit",class:"btn btn-danger",disabled:!((_=a(i))!=null&&_.total)||t.isLoading}," 送出訂單 ",8,Ie)])]}),_:1},512)])]),l(m,{active:t.isLoading,"onUpdate:active":o[6]||(o[6]=s=>t.isLoading=s),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{Fe as default};
