import{b as x,t as R,r as E,o as l,c as r,f as t,n as c,q as a,s as L,v as V,x as w,y as U,g as P,h as I,F as T,z as A,j as $,u as D,a as M,A as k,i as B,B as S}from"./index-2c81f593.js";import{u as F}from"./useModal-a2fd0851.js";import{_ as N}from"./PaginationComponent.vue_vue_type_style_index_0_lang-73464f21.js";const q={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},j={id:"findMoreModalLabel",class:"modal-title"},H={class:"modal-body"},K={class:"row"},Q={class:"col-sm-6"},X=["src"],G={class:"col-sm-6"},J={class:"badge bg-primary rounded-pill"},W={key:0,class:"h5"},Y={key:1},Z={class:"h6"},tt={class:"h5"},et={class:"input-group"},st=x({__name:"UserFindMoreModal",props:{tempProduct:null,addToCart:{type:Function}},setup(v,{expose:p}){const e=R(v,"tempProduct"),b=E(""),{showModal:g,hideModal:_}=F(b);let u=1;const y=()=>{u=1};return p({showModal:g,hideModal:_}),(C,n)=>{var i;return l(),r("div",{id:"findMoreModal",ref_key:"findMoreModalRef",ref:b,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"findMoreModalLabel","aria-hidden":"true"},[t("div",q,[t("div",z,[t("div",O,[t("h5",j,[t("span",null,c(a(e).title),1)]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",onClick:n[0]||(n[0]=(...o)=>a(_)&&a(_)(...o))})]),t("div",H,[t("div",K,[t("div",Q,[a(e).imagesUrl?(l(),r("img",{key:0,class:"img-fluid",src:(i=a(e))==null?void 0:i.imagesUrl[0],alt:""},null,8,X)):L("",!0)]),t("div",G,[t("span",J,c(a(e).category),1),t("p",null,"商品描述："+c(a(e).description),1),t("p",null,"商品內容："+c(a(e).content),1),a(e).price<a(e).origin_price?(l(),r("div",W,c(a(e).origin_price)+" 元 ",1)):(l(),r("div",Y,[t("del",Z,"原價 "+c(a(e).origin_price)+" 元",1),t("div",tt,"現在只要 "+c(a(e).price)+" 元",1)])),t("div",null,[t("div",et,[V(t("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>U(u)?u.value=o:u=o),min:"1",type:"number",class:"form-control"},null,512),[[w,a(u),void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:n[2]||(n[2]=o=>(v.addToCart(a(e).id,a(u)),y()))}," 加入購物車 ")])])])])])])])],512)}}}),ot={class:"container"},nt={class:"mt-4"},at={class:"table align-middle"},it=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),dt={key:0},lt={style:{width:"200px"}},rt={key:0},ct={class:"h6"},ut={class:"h5"},_t={key:1,class:"h5"},pt={class:"btn-group btn-group-sm"},gt=["disabled","onClick"],mt=["disabled","onClick"],ht=["disabled","onClick"],bt={class:"d-flex justify-content-center"},$t=x({__name:"UserProductsView",setup(v){const{VITE_URL:p,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=P({products:[],pagination:{},tempProduct:{imagesUrl:[]},isLoading:!1}),b=D(),g=E(),_=async(n=e.pagination.current_page||1)=>{var o;const i=`${p}/api/${h}/products?page=${n}`;e.isLoading=!0;try{const d=await M.get(i);e.isLoading=!1,e.products=d.data.products,e.pagination=d.data.pagination}catch(d){d instanceof k&&alert((o=d.response)==null?void 0:o.data.message)}},u=async(n,i=1)=>{var s,m;const o=`${p}/api/${h}/cart`,d={product_id:n,qty:i};e.isLoading=!0;try{const f=await M.post(o,{data:d});e.isLoading=!1,(s=g.value)==null||s.hideModal(),alert(f.data.message)}catch(f){f instanceof k&&alert((m=f.response)==null?void 0:m.data.message)}};I(()=>{_()});const y=(n,i)=>{var o;switch(n){case"findMore":e.tempProduct={...i},(o=g.value)==null||o.showModal();break}},C=async n=>{var d;const{id:i}=n,o=`${p}/api/${h}/product/${i}`;e.tempProduct={...n},e.isLoading=!0;try{await M.get(o),e.isLoading=!1,b.push(`/product/${i}`)}catch(s){s instanceof k&&alert((d=s.response)==null?void 0:d.data.message)}};return(n,i)=>{var d;const o=B("Loading");return l(),r(T,null,[t("div",ot,[t("div",nt,[t("table",at,[it,(d=e.products)!=null&&d.length?(l(),r("tbody",dt,[(l(!0),r(T,null,A(e==null?void 0:e.products,s=>(l(),r("tr",{key:s.id},[t("td",lt,[s.imagesUrl?(l(),r("div",{key:0,style:S([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s==null?void 0:s.imagesUrl[0]})`}])},null,4)):L("",!0)]),t("td",null,c(s.title),1),t("td",null,[s.price<s.origin_price?(l(),r("div",rt,[t("del",ct,"原價 "+c(s.origin_price)+" 元",1),t("div",ut,"現在只要 "+c(s.price)+" 元",1)])):(l(),r("div",_t,c(s.origin_price)+" 元",1))]),t("td",null,[t("div",pt,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:m=>C(s)}," 詳細希望 ",8,gt),t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:m=>y("findMore",s)}," 查看更多 ",8,mt),t("button",{type:"button",class:"btn btn-outline-danger",disabled:e.isLoading,onClick:m=>u(s.id)}," 加到購物車 ",8,ht)])])]))),128))])):L("",!0)])]),t("div",bt,[$(N,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:_},null,8,["pagination"])])]),$(st,{ref_key:"findMoreModalRef",ref:g,"temp-product":e.tempProduct,"add-to-cart":u},null,8,["temp-product"]),$(o,{active:e.isLoading,"onUpdate:active":i[0]||(i[0]=s=>e.isLoading=s),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{$t as default};
