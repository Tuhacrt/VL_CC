import{d as E,t as P,r as x,o as d,c as l,b as t,g as r,h as a,i as C,j as R,v as V,k as w,l as U,m as I,F as T,n as A,e as k,p as D,q as M,A as L,a as S,s as B}from"./index-f10d7621.js";import{u as F}from"./useModal-cc9e8f56.js";import{P as N}from"./PaginationComponent-93283b55.js";const q={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},j={class:"modal-header bg-dark text-white"},z={id:"findMoreModalLabel",class:"modal-title"},H={class:"modal-body"},K={class:"row"},Q={class:"col-sm-6"},X=["src"],G={class:"col-sm-6"},J={class:"badge bg-primary rounded-pill"},W={key:0,class:"h5"},Y={key:1},Z={class:"h6"},tt={class:"h5"},et={class:"input-group"},ot=E({__name:"FindMoreModal",props:{tempProduct:null,addToCart:{type:Function}},setup(y,{expose:_}){const e=P(y,"tempProduct"),h=x(""),{modal:b,showModal:f,hideModal:p}=F(h);let u=1;const $=()=>{u=1};return _({showModal:f,hideModal:p}),(c,n)=>{var i;return d(),l("div",{id:"findMoreModal",ref_key:"findMoreModalRef",ref:h,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"findMoreModalLabel","aria-hidden":"true"},[t("div",q,[t("div",O,[t("div",j,[t("h5",z,[t("span",null,r(a(e).title),1)]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",onClick:n[0]||(n[0]=(...s)=>a(p)&&a(p)(...s))})]),t("div",H,[t("div",K,[t("div",Q,[a(e).imagesUrl?(d(),l("img",{key:0,class:"img-fluid",src:(i=a(e))==null?void 0:i.imagesUrl[0],alt:""},null,8,X)):C("",!0)]),t("div",G,[t("span",J,r(a(e).category),1),t("p",null,"商品描述："+r(a(e).description),1),t("p",null,"商品內容："+r(a(e).content),1),a(e).price<a(e).origin_price?(d(),l("div",W,r(a(e).origin_price)+" 元 ",1)):(d(),l("div",Y,[t("del",Z,"原價 "+r(a(e).origin_price)+" 元",1),t("div",tt,"現在只要 "+r(a(e).price)+" 元",1)])),t("div",null,[t("div",et,[R(t("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>w(u)?u.value=s:u=s),min:"1",type:"number",class:"form-control"},null,512),[[V,a(u),void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:n[2]||(n[2]=s=>(y.addToCart(a(e).id,a(u)),$()))}," 加入購物車 ")])])])])])])])],512)}}}),st={class:"container"},nt={class:"mt-4"},at={class:"table align-middle"},it=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),dt={key:0},lt={style:{width:"200px"}},rt={key:0},ct={class:"h6"},ut={class:"h5"},pt={key:1,class:"h5"},_t={class:"btn-group btn-group-sm"},gt=["disabled","onClick"],mt=["disabled","onClick"],ht=["disabled","onClick"],bt={class:"d-flex justify-content-center"},$t=E({__name:"UserProductsView",setup(y){const{VITE_URL:_,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/VL_CC/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=U({products:[],pagination:{},tempProduct:{imagesUrl:[]},isLoading:!1}),h=D(),b=x(),f=async(c=e.pagination.current_page||1)=>{var i;const n=`${_}/api/${m}/products?page=${c}`;e.isLoading=!0;try{const s=await M.get(n);e.isLoading=!1,e.products=s.data.products,e.pagination=s.data.pagination}catch(s){s instanceof L&&alert((i=s.response)==null?void 0:i.data.message)}},p=async(c,n=1)=>{var o,g;const i=`${_}/api/${m}/cart`,s={product_id:c,qty:n};e.isLoading=!0;try{const v=await M.post(i,{data:s});e.isLoading=!1,(o=b.value)==null||o.hideModal(),alert(v.data.message)}catch(v){v instanceof L&&alert((g=v.response)==null?void 0:g.data.message)}};I(()=>{f()});const u=(c,n)=>{var i;switch(c){case"findMore":e.tempProduct={...n},(i=b.value)==null||i.showModal();break}},$=async c=>{var s;const{id:n}=c,i=`${_}/api/${m}/product/${n}`;e.tempProduct={...c},e.isLoading=!0;try{await M.get(i),e.isLoading=!1,h.push(`/product/${n}`)}catch(o){o instanceof L&&alert((s=o.response)==null?void 0:s.data.message)}};return(c,n)=>{var s;const i=S("Loading");return d(),l(T,null,[t("div",st,[t("div",nt,[t("table",at,[it,(s=e.products)!=null&&s.length?(d(),l("tbody",dt,[(d(!0),l(T,null,A(e==null?void 0:e.products,o=>(d(),l("tr",{key:o.id},[t("td",lt,[o.imagesUrl?(d(),l("div",{key:0,style:B([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${o==null?void 0:o.imagesUrl[0]})`}])},null,4)):C("",!0)]),t("td",null,r(o.title),1),t("td",null,[o.price<o.origin_price?(d(),l("div",rt,[t("del",ct,"原價 "+r(o.origin_price)+" 元",1),t("div",ut,"現在只要 "+r(o.price)+" 元",1)])):(d(),l("div",pt,r(o.origin_price)+" 元",1))]),t("td",null,[t("div",_t,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:g=>$(o)}," 詳細希望 ",8,gt),t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:g=>u("findMore",o)}," 查看更多 ",8,mt),t("button",{type:"button",class:"btn btn-outline-danger",disabled:e.isLoading,onClick:g=>p(o.id)}," 加到購物車 ",8,ht)])])]))),128))])):C("",!0)])]),t("div",bt,[k(N,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:f},null,8,["pagination"])])]),k(ot,{ref_key:"findMoreModalRef",ref:b,"temp-product":e.tempProduct,"add-to-cart":p},null,8,["temp-product"]),k(i,{active:e.isLoading,"onUpdate:active":n[0]||(n[0]=o=>e.isLoading=o),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{$t as default};
